<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-14.635559558868408 -8 688.776123046875 1073.8240966796875" style="max-width: 688.776123046875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749544043732-r5yr7r46b"><style>#mermaid-svg-1749544043732-r5yr7r46b{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b .error-icon{fill:#5a1d1d;}#mermaid-svg-1749544043732-r5yr7r46b .error-text{fill:#f48771;stroke:#f48771;}#mermaid-svg-1749544043732-r5yr7r46b .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749544043732-r5yr7r46b .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749544043732-r5yr7r46b .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749544043732-r5yr7r46b .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749544043732-r5yr7r46b .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749544043732-r5yr7r46b .marker{fill:#cccccc;stroke:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b .marker.cross{stroke:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749544043732-r5yr7r46b .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b .cluster-label text{fill:#d4dce4;}#mermaid-svg-1749544043732-r5yr7r46b .cluster-label span,#mermaid-svg-1749544043732-r5yr7r46b p{color:#d4dce4;}#mermaid-svg-1749544043732-r5yr7r46b .label text,#mermaid-svg-1749544043732-r5yr7r46b span,#mermaid-svg-1749544043732-r5yr7r46b p{fill:#cccccc;color:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b .node rect,#mermaid-svg-1749544043732-r5yr7r46b .node circle,#mermaid-svg-1749544043732-r5yr7r46b .node ellipse,#mermaid-svg-1749544043732-r5yr7r46b .node polygon,#mermaid-svg-1749544043732-r5yr7r46b .node path{fill:#232a2f;stroke:#1a2023;stroke-width:1px;}#mermaid-svg-1749544043732-r5yr7r46b .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749544043732-r5yr7r46b .node .label{text-align:center;}#mermaid-svg-1749544043732-r5yr7r46b .node.clickable{cursor:pointer;}#mermaid-svg-1749544043732-r5yr7r46b .arrowheadPath{fill:#dcd5d0;}#mermaid-svg-1749544043732-r5yr7r46b .edgePath .path{stroke:#cccccc;stroke-width:2.0px;}#mermaid-svg-1749544043732-r5yr7r46b .flowchart-link{stroke:#cccccc;fill:none;}#mermaid-svg-1749544043732-r5yr7r46b .edgeLabel{background-color:#232a2f99;text-align:center;}#mermaid-svg-1749544043732-r5yr7r46b .edgeLabel rect{opacity:0.5;background-color:#232a2f99;fill:#232a2f99;}#mermaid-svg-1749544043732-r5yr7r46b .labelBkg{background-color:rgba(35, 42, 47, 0.5);}#mermaid-svg-1749544043732-r5yr7r46b .cluster rect{fill:rgba(32, 64, 98, 0.5);stroke:#707a84;stroke-width:1px;}#mermaid-svg-1749544043732-r5yr7r46b .cluster text{fill:#d4dce4;}#mermaid-svg-1749544043732-r5yr7r46b .cluster span,#mermaid-svg-1749544043732-r5yr7r46b p{color:#d4dce4;}#mermaid-svg-1749544043732-r5yr7r46b div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#4d4d4d;border:1px solid #707a84;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749544043732-r5yr7r46b .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#cccccc;}#mermaid-svg-1749544043732-r5yr7r46b :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-svg-1749544043732-r5yr7r46b .hashStyle&gt;*{fill:#fff9c4!important;stroke:#f57f17!important;stroke-width:2px!important;}#mermaid-svg-1749544043732-r5yr7r46b .hashStyle span{fill:#fff9c4!important;stroke:#f57f17!important;stroke-width:2px!important;}#mermaid-svg-1749544043732-r5yr7r46b .gatewayStyle&gt;*{fill:#e8f5e8!important;stroke:#2e7d32!important;stroke-width:2px!important;}#mermaid-svg-1749544043732-r5yr7r46b .gatewayStyle span{fill:#e8f5e8!important;stroke:#2e7d32!important;stroke-width:2px!important;}#mermaid-svg-1749544043732-r5yr7r46b .errorStyle&gt;*{stroke:#c62828!important;stroke-width:2px!important;stroke-dasharray:5 5!important;}#mermaid-svg-1749544043732-r5yr7r46b .errorStyle span{stroke:#c62828!important;stroke-width:2px!important;stroke-dasharray:5 5!important;}#mermaid-svg-1749544043732-r5yr7r46b .formatStyle&gt;*{fill:#f3e5f5!important;stroke:#4a148c!important;stroke-width:1px!important;}#mermaid-svg-1749544043732-r5yr7r46b .formatStyle span{fill:#f3e5f5!important;stroke:#4a148c!important;stroke-width:1px!important;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749544043732-r5yr7r46b_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"><g id="ConsistentHashB" class="cluster hashStyle flowchart-label"><rect height="217.96295928955078" width="243.58905029296875" y="731.458324432373" x="-6.63555908203125" ry="0" rx="0" style=""/><g transform="translate(-6.63555908203125, 731.458324432373)" class="cluster-label"><foreignObject height="21.990739822387695" width="243.58905029296875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">🧭 导航系统B (msggateway-proxy)</span></div></foreignObject></g></g><g id="ConsistentHashA" class="cluster hashStyle flowchart-label"><rect height="442.0833282470703" width="230.31793212890625" y="0" x="0" ry="0" rx="0" style=""/><g transform="translate(14.328887939453125, 0)" class="cluster-label"><foreignObject height="21.990739822387695" width="201.66015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">🧭 导航系统A (openim-push)</span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-Client LE-HashB" id="L-Client-HashB-0" d="M115.159,681.458L115.159,685.625C115.159,689.792,115.159,698.125,115.159,706.458C115.159,714.792,115.159,723.125,115.159,730.575C115.159,738.025,115.159,744.592,115.159,747.875L115.159,751.158"/><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-HashB LE-ResultB" id="L-HashB-ResultB-0" d="M115.159,837.431L115.159,841.597C115.159,845.764,115.159,854.097,115.159,861.547C115.159,868.997,115.159,875.564,115.159,878.847L115.159,882.131"/><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-ResultB LE-Gateway0" id="L-ResultB-Gateway0-0" d="M115.159,924.421L115.159,928.588C115.159,932.755,115.159,941.088,115.159,949.421C115.159,957.755,115.159,966.088,115.159,973.538C115.159,980.988,115.159,987.555,115.159,990.838L115.159,994.121"/><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-HashA LE-ResultA" id="L-HashA-ResultA-0" d="M115.159,218.032L115.159,240.876C115.159,263.719,115.159,309.406,115.159,335.533C115.159,361.659,115.159,368.226,115.159,371.509L115.159,374.793"/><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-ResultA LE-Gateway1" id="L-ResultA-Gateway1-0" d="M115.159,417.083L115.159,421.25C115.159,425.417,115.159,433.75,115.159,442.083C115.159,450.417,115.159,458.75,115.159,466.2C115.159,473.65,115.159,480.217,115.159,483.5L115.159,486.783"/><path marker-end="url(#mermaid-svg-1749544043732-r5yr7r46b_flowchart-pointEnd)" style="fill:none;stroke-width:2px;stroke-dasharray:3;" class="edge-thickness-normal edge-pattern-dotted flowchart-link LS-Gateway1 LE-Client" id="L-Gateway1-Client-0" d="M115.159,550.486L115.159,558.318C115.159,566.15,115.159,581.813,115.159,596.594C115.159,611.374,115.159,625.271,115.159,632.219L115.159,639.168"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 597.4768466949463)" class="edgeLabel"><g transform="translate(-50.500938415527344, -21.990739822387695)" class="label"><foreignObject height="43.98147964477539" width="101.00187683105469"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">❌ 用户不在线<br />发送离线通知</span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(115.15896606445312, 796.9444351196289)" id="flowchart-HashB-200" class="node default default flowchart-label"><rect height="80.97222137451172" width="153.66282653808594" y="-40.48611068725586" x="-76.83141326904297" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-69.33141326904297, -32.98611068725586)" style="" class="label"><rect/><foreignObject height="65.97222137451172" width="138.66282653808594"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">一致性Hash计算<br />输入: user123<br />节点列表: 无端口号</span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 905.9259147644043)" id="flowchart-ResultB-201" class="node default default flowchart-label"><rect height="36.990739822387695" width="130.05352783203125" y="-18.495369911193848" x="-65.02676391601562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-57.526763916015625, -10.995369911193848)" style="" class="label"><rect/><foreignObject height="21.990739822387695" width="115.05352783203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">计算结果: 站点0</span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 177.54629516601562)" id="flowchart-HashA-198" class="node default default flowchart-label"><rect height="80.97222137451172" width="160.31793212890625" y="-40.48611068725586" x="-80.15896606445312" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-72.65896606445312, -32.98611068725586)" style="" class="label"><rect/><foreignObject height="65.97222137451172" width="145.31793212890625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">一致性Hash计算<br />输入: user123<br />节点列表: 带:88端口</span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 398.5879592895508)" id="flowchart-ResultA-199" class="node default default flowchart-label"><rect height="36.990739822387695" width="130.05352783203125" y="-18.495369911193848" x="-65.02676391601562" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-57.526763916015625, -10.995369911193848)" style="" class="label"><rect/><foreignObject height="21.990739822387695" width="115.05352783203125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">计算结果: 站点1</span></div></foreignObject></g></g><g transform="translate(257.81793212890625, 17)" class="root"><g class="clusters"><g id="Legend" class="cluster default flowchart-label"><rect height="305.09259033203125" width="400.3226318359375" y="8" x="8" ry="0" rx="0" style=""/><g transform="translate(149.6625099182129, 8)" class="cluster-label"><foreignObject height="21.990739822387695" width="116.99761199951172"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">📋 地址格式对比</span></div></foreignObject></g></g></g><g class="edgePaths"/><g class="edgeLabels"/><g class="nodes"><g transform="translate(208.16131591796875, 89.27314758300781)" id="flowchart-FormatA-195" class="node default formatStyle flowchart-label"><rect height="92.54629516601562" width="269.51210021972656" y="-46.27314758300781" x="-134.75605010986328" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-127.25605010986328, -38.77314758300781)" style="" class="label"><rect/><foreignObject height="77.54629516601562" width="254.51210021972656"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">🚚 openim-push 使用的地址格式:<br />server-msggateway-0...svc.local:88<br />server-msggateway-1...svc.local:88<br />server-msggateway-2...svc.local:88</span></div></foreignObject></g></g><g transform="translate(208.16131591796875, 231.81944274902344)" id="flowchart-FormatB-196" class="node default formatStyle flowchart-label"><rect height="92.54629516601562" width="350.3226318359375" y="-46.27314758300781" x="-175.16131591796875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-167.66131591796875, -38.77314758300781)" style="" class="label"><rect/><foreignObject height="77.54629516601562" width="335.3226318359375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">📍 openim-msggateway-proxy 使用的地址格式:<br />server-msggateway-0...svc.local<br />server-msggateway-1...svc.local<br />server-msggateway-2...svc.local</span></div></foreignObject></g></g></g></g><g transform="translate(115.15896606445312, 662.9629554748535)" id="flowchart-Client-197" class="node default default flowchart-label"><rect height="36.990739822387695" width="196.640625" y="-18.495369911193848" x="-98.3203125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-90.8203125, -10.995369911193848)" style="" class="label"><rect/><foreignObject height="21.990739822387695" width="181.640625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">📱 用户 (UserID: user123)</span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 1028.622673034668)" id="flowchart-Gateway0-202" class="node default gatewayStyle flowchart-label"><rect height="58.40277862548828" width="137.76656341552734" y="-29.20138931274414" x="-68.88328170776367" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-61.38328170776367, -21.70138931274414)" style="" class="label"><rect/><foreignObject height="43.40277862548828" width="122.76656341552734"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">🏠 msggateway-0<br />(用户实际连接)</span></div></foreignObject></g></g><g transform="translate(115.15896606445312, 521.2847175598145)" id="flowchart-Gateway1-203" class="node default gatewayStyle flowchart-label"><rect height="58.40277862548828" width="186.7032012939453" y="-29.20138931274414" x="-93.35160064697266" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-85.85160064697266, -21.70138931274414)" style="" class="label"><rect/><foreignObject height="43.40277862548828" width="171.7032012939453"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">🏠 msggateway-1<br />(消息被错误发送到这里)</span></div></foreignObject></g></g></g></g></g></svg>